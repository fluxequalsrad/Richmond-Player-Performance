---
title: "Richmond Player Performance"
output: html_document
---

### Load libraries
```{r load libraries}
library(tidyverse)
library(naniar)
```

###Read in data
```{r load data}
# Player performance data from 1965 to 2024
player_stats <-read.csv("Player Stats 1965-2024.csv")

# List of player information since the club's inception
player_list <-read.csv("Player List.csv")
```

###Data Exploration and preparation
```{r initial exploration}
# View data dimensions
cat("Number of rows:", nrow(player_stats), "\n")
cat("Number of columns:", ncol(player_stats), "\n")

#Is there missing data?
cat("\n", "Amount of missing data per column:", "\n")
colSums(is.na(player_stats))
```
Our Player Stats table contains data for 550 players recorded across 24 attributes. Some missing data is to be expected (i.e. those playing in the back pocket are unlikely to ever kick a goal) but certain columns have a lot more than is correct. When reviewing the data, we can be seen that some attributes only began being recorded during the 1998 and 1999 seasons. For this reason, we will split our data into the 'core' attributes, those recorded since 1965, and the 'modern' attributes, recorded since 1998/1999.

Furthermore, some statistics are redundant and will be removed from our data set. For instance, we care about the number of marks taken, but not whether they were contested or uncontested and the number of Brownlow votes that a player has accrued tells us other's views on the player but can be influenced by factors outside of their pure performance.

As a final step before starting our analysis, null values will be replaced with zeros and players with less than 100 games will be dropped. Playing 100 games for a team is a requirement for the father-son rule and will help reduce our data set as we search for the best player of all time. 

```{r data cleaning}
# drop columns
player_stats <- subset(player_stats, select = -c(HO, BR, CP, UP, CM, MI, BO, GA))
# rename X1. column
names(player_stats)[which(names(player_stats) == "X1.")] <- "1P"
# replace NA with 0
player_stats[is.na(player_stats)] <- 0
# drop players with less than 100 games
player_stats <- filter(player_stats, player_stats$GM >=100)
```

I will create a new column 'ACC' that uses the goals and behinds statistics to calculate the players accuracy.
```{r accuracy metric}
# create accuracy column
player_stats <- mutate(player_stats, ACC = GL / (GL + BH))
# move accuracy column next to GL column
player_stats <- relocate(player_stats, ACC, .after=GL)
# drop behinds column
player_stats <- select(player_stats, "Player", "GM", "KI", "MK", "HB", "DI", "GL", "ACC", "TK", "RB", "IF", "CL", "CG", "FF", "FA", "1P")
```

While subjective, free kicks are usually awarded to players for being first to the ball or strong tackling while they are usually given for undisciplined play. In this analysis, a free kick differential and ratio will both be considered.

```{r free kick columns}
# create differential column
player_stats <- mutate(player_stats, FD = FF - FA)
player_stats <- relocate(player_stats, FD, .after=FA)
# create ratio column
player_stats <- mutate(player_stats, FR = FF / FA)
player_stats <- relocate(player_stats, FR, .after=FD)
# drop behinds column
player_stats <- select(player_stats, "Player", "GM", "KI", "MK", "HB", "DI", "GL", "ACC", "TK", "RB", "IF", "CL", "CG", "FD", "FR", "1P")
```


Disposals are a combination of the Kicks and Handballs columns and as such will not be used on their own. Combining this metric with the Clangers attribute however, will help us assess a player's disposal efficiency.
```{r disposal efficiency}
# create disposal efficiency column
player_stats <- mutate(player_stats, DE = (DI - CG)/DI*100)
player_stats <- relocate(player_stats, DE, .after=DI)
player_stats$DE[player_stats$CG == 0] <- 0
# drop disposals and clangers columns
player_stats <- select(player_stats, "Player", "GM", "KI", "MK", "HB", "DE", "GL", "ACC", "TK", "RB", "IF", "CL", "FD", "FR", "1P")
```

When comparing players in our investigation for who is the best, total values are important but but we'll also want to look at their achievements as per game values. Higher totals will be linked to those who have played more games, something which we do want to reward, but per game values will also provide essential player performance information.
GM, DE, ACC and FD removed from per game table

```{r per game metrics and totals tables}
# create per game dataframe
player_stats_per_game <- player_stats
player_stats_per_game[,3:15] <- player_stats_per_game[, 3:15] / player_stats_per_game$GM
player_stats_per_game$FR <- player_stats_per_game$FR * player_stats_per_game$GM
#drop GM, DE, ACC, FD columns
player_stats_per_game <- select(player_stats_per_game, "Player", "KI", "MK", "HB", "GL", "TK", "RB", "IF", "CL", "FR", "1P")
#drop FR column from totals
player_stats_totals <- select(player_stats, "Player", "GM", "KI", "MK", "HB", "DE", "GL", "ACC", "TK", "RB", "IF", "CL", "FD", "1P")
```

Create two tables that feature just the core stats (those collected since 1965). Analysis will only use these two tables first to prevent bias from players with more stats. Depending on the outcome will bring in the additional stats collected since 1998.

```{r create core stats tables for initial run through}
# Extract core player stats into its own data set
core_ps_totals <- select(player_stats_totals, Player, GM, KI, MK, HB, GL, ACC, FD)
core_ps_per_game <- select(player_stats_per_game, Player, KI, MK, HB, GL, FR)
```


A data dictionary is provided below

```{r data dictionary}
Column_Name <- c("Player", "GM", "KI", "MK", "HB", "DE", "GL", "ACC", "TK", "RB", "IF", "CL", "FD", "FR", "1P")
Description <- c("Player Name", "Games", "Kicks", "Marks", "Handballs", "Disposal Efficiency", "Goals", "Accuracy", "Tackles", "Rebound 50s", "Inside 50s", "Clearances", "Free Differential", "Free Ratio", "1 Percenters")
dict <- data.frame(Column_Name, Description)
print.data.frame(dict, row.names = FALSE, max = NULL)
```
### Player Analysis

Initially just the core stats
Best player will be determined in the following way:
Rank players according to totals by awarding points according to distribution. calculate z-scores for each attribute and player. I'll then normalise the z-scores on a range of 0-100 for ease of readability / interpretation. These values will then be summed to get a final total for each player. This will be completed for both the totals data and the per game data.

GL, ACC - half points as they are primarily aimed at forwards, looking to keep balance between statistics specific to certain positions. Look at distribution of goals, only players with more than median goals can receive accuracy points.

Create weightings for each metric and sum the total and per game values for each player
Combine the total and per game figures based on a weighting to produce one final ranking for each player

Rank player performance based on totals
Note: GL and ACC columns both reward those playing forward positions and are therefore worth half points for balance. Additionally, points for accuracy can only be received by players who have kicked greater than the median number of goals. Median used due to skewed distribution.

```{r rank player performance - totals}
# calculate z-scores for each stat
stats <- c('GM', 'KI', 'MK', 'HB', 'GL', 'ACC', 'FD')
for (stat in stats) {
  z_col <- paste0(stat, "_z")
  core_ps_totals[[z_col]] <- scale(core_ps_totals[[stat]])
}

# normalise z-scores on a 0-100 scale
for (stat in stats) {
  points_col <- paste0(stat, "_points")
  z_col <- paste0(stat, "_z")
  core_ps_totals[[points_col]] <- 50 + (core_ps_totals[[z_col]] * 10)
}

# Removing points from ACC where GL is lower than median
core_ps_totals <- mutate(core_ps_totals, ACC_points = ifelse(GL < median(GL), 0, ACC_points))

# GL and ACC columns are worth half points
core_ps_totals$GL_points <- core_ps_totals$GL_points/2
core_ps_totals$ACC_points <- core_ps_totals$ACC_points/2

# sum the points for each player in a new 'summed_points' column
points_cols <- paste0(stats, "_points")
core_ps_totals$summed_totals <- rowSums(core_ps_totals[points_cols])
```

On raw totals, Kevin Bartlett, an absolute legend of the Richmond football club comes out on top. Playing the most games out of any other player sees him score highly across all stats but this doesn't diminish his performance with his number of kicks being almost double the next best player.


Rank player performance based on per game averages
```{r rank player performance - per game}
# calculate z-scores for each stat
stats <- c('KI', 'MK', 'HB', 'GL', 'FR')
for (stat in stats) {
  z_col <- paste0(stat, "_z")
  core_ps_per_game[[z_col]] <- scale(core_ps_per_game[[stat]])
}

# normalise z-scores on a 0-100 scale
for (stat in stats) {
  points_col <- paste0(stat, "_points")
  z_col <- paste0(stat, "_z")
  core_ps_per_game[[points_col]] <- 50 + (core_ps_per_game[[z_col]] * 10)
} 

# sum the points for each player in a new 'summed_points' column
points_cols <- paste0(stats, "_points")
core_ps_per_game$summed_averages <- rowSums(core_ps_per_game[points_cols])
```
When looking at per game averages, the top two are neck and neck with Brett Deledio, having a more well rounded game, and Matthew Richardson, scoring high in goals and marks. 


Calculate final player points 
```{r player points}
Ranking <- inner_join(select(core_ps_totals, Player, summed_totals),
                       select(core_ps_per_game, Player, summed_averages),
                       by = "Player")
Ranking$final_ranking <- Ranking$summed_totals * 0.6 + Ranking$summed_averages * 0.4

```

Kevin Bartlett comes out on top as Richmond's greatest player but this doesn't give the full picture. Only three of the top ten players are from the pre-1998 era. Let's rerun this analysis using the full data set to give us a clearer picture on how the modern players stack up.

```{r rank player performance - FULL TOTALS}
# calculate z-scores for each stat
stats <- c("GM", "KI", "MK", "HB", "DE", "GL", "ACC", "TK", "RB", "IF", "CL", "FD", "1P")
for (stat in stats) {
  z_col <- paste0(stat, "_z")
  player_stats_totals[[z_col]] <- scale(player_stats_totals[[stat]])
}

# normalise z-scores on a 0-100 scale
for (stat in stats) {
  points_col <- paste0(stat, "_points")
  z_col <- paste0(stat, "_z")
  player_stats_totals[[points_col]] <- 50 + (player_stats_totals[[z_col]] * 10)
}

# Removing points from ACC where GL is lower than median
player_stats_totals <- mutate(player_stats_totals, ACC_points = ifelse(GL < median(GL), 0, ACC_points))

# GL and ACC columns are worth half points
player_stats_totals$GL_points <- player_stats_totals$GL_points/2
player_stats_totals$ACC_points <- player_stats_totals$ACC_points/2

# sum the points for each player in a new 'summed_points' column
points_cols <- paste0(stats, "_points")
player_stats_totals$summed_totals <- rowSums(player_stats_totals[points_cols])
```

Looking at the totals for the full stats, Trent Cotchin is number one, Dustin has moved from 5 to 2 (clearances and inside 50s), Joel Bowden 12 to 3 ( Rebound 50s).

Rank player performance based on per game averages
```{r rank player performance - FULL AVERAGES}
# calculate z-scores for each stat
stats <- c("KI", "MK", "HB", "GL", "TK", "RB", "IF", "CL", "FR", "1P")
for (stat in stats) {
  z_col <- paste0(stat, "_z")
  player_stats_per_game[[z_col]] <- scale(player_stats_per_game[[stat]])
}

# normalise z-scores on a 0-100 scale
for (stat in stats) {
  points_col <- paste0(stat, "_points")
  z_col <- paste0(stat, "_z")
  player_stats_per_game[[points_col]] <- 50 + (player_stats_per_game[[z_col]] * 10)
} 

# sum the points for each player in a new 'summed_points' column
points_cols <- paste0(stats, "_points")
player_stats_per_game$summed_averages <- rowSums(player_stats_per_game[points_cols])
```

Brett Deledio on top. Surprising, never top 5? but consistently good across the board.

Calculate final player points 
```{r FULL player points}
Ranking <- inner_join(select(player_stats_totals, Player, summed_totals),
                       select(player_stats_per_game, Player, summed_averages),
                       by = "Player")
Ranking$final_ranking <- Ranking$summed_totals * 0.6 + Ranking$summed_averages * 0.4

```

Trent Cotchin best modern Richmond player
